<!DOCTYPE html>
<html>
<head>
    <title>Login Test</title>
    <style>
        body { font-family: monospace; background: #0f172a; color: #cbd5e1; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; border-left: 3px solid; }
        .error { border-color: red; color: red; }
        .success { border-color: green; color: green; }
        .info { border-color: blue; color: #60a5fa; }
        button { padding: 10px 20px; margin-top: 20px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 4px; }
        button:hover { background: #1d4ed8; }
        #output { background: #1e293b; padding: 20px; border-radius: 8px; margin-top: 20px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üè• Login Test - HR4</h1>
    <p>This page tests the complete login and dashboard initialization flow.</p>
    
    <button onclick="testLogin()">Test Login Flow</button>
    <button onclick="checkLocalStorage()">Check LocalStorage</button>
    <button onclick="clearAll()">Clear All Data</button>
    
    <div id="output"></div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        async function testLogin() {
            log('=== Starting Login Test ===', 'info');
            
            try {
                log('1. Sending login request...', 'info');
                
                const response = await fetch('http://localhost/hospital_4/api/auth/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@hospital.com',
                        password: 'admin123'
                    })
                });

                log('2. Response status: ' + response.status, response.ok ? 'success' : 'error');

                const data = await response.json();
                log('3. Response received', 'success');

                if (data.success) {
                    log('‚úì Login successful!', 'success');
                    log('4. Response has success: true', 'success');
                    
                    // Check response data
                    if (data.data && data.data.token) {
                        log('‚úì Token present: ' + data.data.token.substring(0, 20) + '...', 'success');
                    } else {
                        log('‚úó No token in response', 'error');
                    }
                    
                    if (data.data && data.data.user) {
                        log('‚úì User data present: ' + JSON.stringify(data.data.user), 'success');
                    } else {
                        log('‚úó No user data in response', 'error');
                    }

                    // Store in localStorage
                    log('5. Storing in localStorage...', 'info');
                    localStorage.setItem('authToken', data.data.token);
                    localStorage.setItem('userData', JSON.stringify(data.data.user));
                    log('‚úì Stored successfully', 'success');

                    // Verify storage
                    log('6. Verifying storage...', 'info');
                    const token = localStorage.getItem('authToken');
                    const userData = localStorage.getItem('userData');
                    
                    log('Token in localStorage: ' + (token ? 'YES ‚úì' : 'NO ‚úó'), token ? 'success' : 'error');
                    log('User in localStorage: ' + (userData ? 'YES ‚úì' : 'NO ‚úó'), userData ? 'success' : 'error');

                    if (token && userData) {
                        log('‚úì‚úì‚úì LOGIN FLOW COMPLETE - Ready for Dashboard ‚úì‚úì‚úì', 'success');
                        log('You can now visit: http://localhost/hospital_4/public/dashboard.html', 'info');
                    }
                } else {
                    log('‚úó Login failed: ' + data.message, 'error');
                }
            } catch (error) {
                log('‚úó Error: ' + error.message, 'error');
            }
        }

        function checkLocalStorage() {
            log('=== LocalStorage Check ===', 'info');
            
            const token = localStorage.getItem('authToken');
            const userData = localStorage.getItem('userData');
            
            log('authToken exists: ' + (token ? 'YES' : 'NO'), token ? 'success' : 'error');
            log('userData exists: ' + (userData ? 'YES' : 'NO'), userData ? 'success' : 'error');
            
            if (token) {
                log('Token: ' + token.substring(0, 50) + '...', 'info');
            }
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    log('User: ' + JSON.stringify(user), 'success');
                } catch (e) {
                    log('‚úó Error parsing user data: ' + e.message, 'error');
                }
            }
        }

        function clearAll() {
            localStorage.clear();
            log('‚úì LocalStorage cleared', 'success');
        }

        log('Page loaded - ready for testing', 'info');
    </script>
</body>
</html>
